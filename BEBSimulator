import java.util.ArrayList;

public class BEBSimulator {
	private int number_of_nodes = 5;
	private int number_of_time_slots = 2;
	private double probability_node_sendFrame = 1 / number_of_time_slots;
	
	
	public void timeSlotLoop(Node[] nodes) {
		Node[] temp = nodes;
		boolean breakCheck = false;
		for (int i = 0; i < number_of_time_slots; i++) {
			ArrayList<Integer> senders = new ArrayList<Integer>();
			// Calls sendFrame for each node
			for (int j = 0; j < temp.length; j ++) {
				if (temp[j] != null)
					if (temp[j].sendFrame(probability_node_sendFrame))
						senders.add(j);
			}
			if (senders.isEmpty()) {
				System.out.print("[UNUSED] ");
			}
			else if (senders.size() == 1) {
				temp[senders.get(0)] = null;
				System.out.print("[SEND " + senders.get(0) + "] ");
			}
			else {
				String output = "[COLLISON ";
				probability_node_sendFrame = probability_node_sendFrame / 2;
				number_of_time_slots = number_of_time_slots * 2;
				for (int j = 0; j < senders.size(); j++) {
					temp[senders.get(j)].collision(number_of_time_slots);
					output += senders.get(j) + " ";
				}
				output += "] ";
				System.out.print(output);
				breakCheck = true;
				break;
			}
		}
		if (breakCheck)
			timeSlotLoop(temp);
	}
	
	
	public void simulate() {
		Node[] nodes = new Node[number_of_nodes];
		for (int i = 0; i < number_of_nodes; i++)
			nodes[i] = new Node();
		// As long as a node needs to send, loop
		timeSlotLoop(nodes);
	}
	
	
	public static void main(String[] args) {
		BEBSimulator test = new BEBSimulator();
		test.simulate();
	}
}
